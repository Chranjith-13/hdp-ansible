---
- name: Creating User={{user_has_permission}}
  user: name={{user_has_permission}} password={{password1}}

- name: Creating user={{user_doesnot_have_permission}}
  user: name={{user_doesnot_have_permission}} password={{password2}}

- name: HDFS Plugin Enforcement For True-Positive Case
  command: "hdfs dfs -mkdir {{create_hdfs_dir}}"
  become_user: " {{user_has_permission}} "
  become: yes
  become_method: su
  ignore_errors: True

- name: HDFS Plugin Enforcement For True-Negative Case
  command: "hdfs dfs -mkdir {{create_hdfs_dir}}"
  become_user: " {{user_doesnot_have_permission}} "
  become: yes
  become_method: su
  ignore_errors: True

- name: creating table schema file " {{hbase_schema_file}} "
  file: path={{hbase_schema_file}} state=touch mode=777

- copy: content="{{hbase_table_query}}" dest="{{hbase_schema_file}}"

- name: Copying HBASE schema file to /home/{{user_has_permission}}
  copy: src={{hbase_schema_file}} dest="/home/{{user_has_permission}}/tables.txt"
  ignore_errors: True
  
- name: HBASE Plugin Enforcement For True-Positive Case
  command: "hbase shell /home/{{user_has_permission}}/tables.txt"
  become_user: " {{user_has_permission}} "
  become: yes
  become_method: su
  ignore_errors: True

- name: HBASE Plugin Enforcement For True-Negative Case
  command: "hbase shell {{hbase_schema_file}}"
  become_user: root
  become: yes
  become_method: su
  ignore_errors: True

- name: HIVE Plugin Enforcement For True-Positive Case
  shell: '/usr/bin/beeline -u "jdbc:hive2://{{hive_server_host}}:10000" -n {{user_has_permission}} -p {{password1}} -d org.apache.hive.jdbc.HiveDriver -e " {{hive_create_table_query}} "'
  ignore_errors: True

- name: HIVE Plugin Enforcement For True-Negative Case
  shell: '/usr/bin/beeline -u "jdbc:hive2://{{hive_server_host}}:10000" -n {{user_doesnot_have_permission}} -p {{password2}} -d org.apache.hive.jdbc.HiveDriver -e " {{hive_create_table_query}} "'
  ignore_errors: True

- name: Changing Hadoop file permissions
  file:
    path: "{{hadoop_mapreduce_jar_path}}"
    mode: 0777

- name: YARN Plugin Enforcement for True-Positive Case
  command: "yarn jar {{hadoop_mapreduce_jar_path}} pi -Dmapred.job.queue.name={{yarn_queue}} 16 100000"
  become_user: " {{user_has_permission}} "
  become: yes
  become_method: su
  ignore_errors: True

- name: YARN Plugin Enforcement for True-Negative Case
  command: "yarn jar {{hadoop_mapreduce_jar_path}} pi -Dmapred.job.queue.name={{yarn_queue}} 16 100000"
  become_user: " {{user_doesnot_have_permission}} "
  become: yes
  become_method: su
  ignore_errors: True
